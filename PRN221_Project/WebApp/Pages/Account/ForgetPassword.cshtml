@page
@model WebApp.Pages.Account.ForgetPasswordModel
@{
    ViewData["Title"] = "Forget Password";
}

<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Forget Password</title>
    <!-- CSS styles -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css">

    <style>
        body {
            background-color: #f8f9fa;
        }

        .auth-form-transparent {
            background: #fff;
            border-radius: 10px;
            box-shadow: 0px 0px 25px 0px rgba(0,0,0,0.1);
            padding: 30px;
        }

        .brand-logo img {
            width: 100px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="row justify-content-center mt-5">
            <div class="col-lg-6">
                <div class="auth-form-transparent text-left p-3">
                    <div class="brand-logo text-center mb-4">
                       
                    </div>
                    <h4>Forget Password</h4>
                    <h6 class="font-weight-light">Enter your email to receive OTP</h6>
                    <form id="forget-password-form" method="post">
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" asp-for="Input.Email" class="form-control" placeholder="Enter your email">
                            <span asp-validation-for="Input.Email" class="text-danger"></span>
                        </div>

                        <div id="otp-container" style="display: none;">
                            <hr />
                            <h4>Verify OTP</h4>
                            <div class="form-group">
                                <label>Enter OTP</label>
                                <input type="text" asp-for="Input.OTP" class="form-control" placeholder="Enter OTP">
                                <span asp-validation-for="Input.OTP" class="text-danger"></span>
                            </div>
                            <div class="form-group">
                                <label>New Password</label>
                                <input type="password" asp-for="Input.NewPassword" class="form-control" placeholder="Enter new password">
                                <span asp-validation-for="Input.NewPassword" class="text-danger"></span>
                            </div>
                            <div class="form-group">
                                <label>Confirm New Password</label>
                                <input type="password" asp-for="Input.ConfirmNewPassword" class="form-control" placeholder="Confirm new password">
                                <span asp-validation-for="Input.ConfirmNewPassword" class="text-danger"></span>
                            </div>
                        </div>

                        <button id="send-otp-submit" class="btn btn-danger btn-block">Send OTP</button>
                        <button id="otp-submit" class="btn btn-primary btn-block" style="display: none;">Confirm OTP</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- jQuery and Bootstrap Bundle (includes Popper) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.min.js"></script>
    <!-- jQuery AJAX -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- SweetAlert2 library -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        $(document).ready(function () {
            $('#send-otp-submit').click(function (e) {
                e.preventDefault(); // Prevent form submission

                $.ajax({
                    url: '/Account/ForgetPassword?handler=SendOTP',
                    type: 'POST',
                    data: $('#forget-password-form').serialize(),
                    dataType: 'json',
                    success: function (response) {
                        if (response.success) {
                            $('#otp-container').show();
                            $('#send-otp-submit').hide();
                            $('#otp-submit').show();
                            Swal.fire({
                                icon: 'success',
                                title: 'OTP Sent',
                                text: 'OTP has been sent to your email.'
                            });
                        } else {
                            Swal.fire({
                                icon: 'error',
                                title: 'Error',
                                text: response.message
                            });
                        }
                    },
                    error: function () {
                        Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: 'Failed to send OTP.'
                        });
                    }
                });
            });

            $('#otp-submit').click(function (e) {
                e.preventDefault(); // Prevent form submission

                $.ajax({
                    url: '/Account/ForgetPassword?handler=ConfirmOTP',
                    type: 'POST',
                    data: $('#forget-password-form').serialize(),
                    dataType: 'json',
                    success: function (response) {
                        if (response.success) {
                            Swal.fire({
                                icon: 'success',
                                title: 'Password Reset',
                                text: 'Your password has been reset successfully.'
                            }).then(function () {
                                window.location.href = '/Account/Login';
                            });
                        } else {
                            Swal.fire({
                                icon: 'error',
                                title: 'Error',
                                text: response.message
                            });
                        }
                    },
                    error: function () {
                        Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: 'Failed to verify OTP.'
                        });
                    }
                });
            });
        });
    </script>
</body>
</html>
